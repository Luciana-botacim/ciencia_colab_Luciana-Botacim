---
title: "Reconstru√ß√£o Filogen√©tica"
author: "Luciana Botacim"
date: "2025-06-03"
output: html_document
tabset: true
---

## {.tabset}

### Estudo

Utilizaremos dados provenientes de um banco de dados para a reconstru√ß√£o da filogenia das esp√©cies em estudo. A an√°lise filogen√©tica √© um passo fundamental para a avalia√ß√£o de padr√µes de estrutura filogen√©tica, permitindo a investiga√ß√£o de processos ecol√≥gicos e evolutivos subjacentes √† composi√ß√£o das comunidades.


<h1 style="font-size: 32px; text-align: center;">Base de dados utilizada</h1>

Os dados que utilizaremos foram obtidos no **Reposit√≥rio de Dados de Estudos Ecol√≥gicos CENBAM/PPBio**, vinculado √† plataforma **DataONE**.

![](dataON.png)

O estudo selecionado √©:

> **Fl√°via RC Costa. _Composi√ß√£o da Comunidade de Ervas Terrestres da Reserva Ducke_. Programa de Pesquisa em Biodiversidade (PPBio).**

Este conjunto de dados re√∫ne informa√ß√µes sobre a composi√ß√£o de ervas terrestres na **Reserva Florestal Adolpho Ducke**, na Amaz√¥nia Central. Ele ser√° nosso modelo pois cont√©m:

- Lista de esp√©cies por unidade amostral
Al√©m de:
- Matriz de composi√ß√£o da comunidade
- Metadados

---


### Dados

1. Site do reposit√≥rio:  
   üëâ [https://ppbio.inpa.gov.br/repositorio/dados](https://ppbio.inpa.gov.br/repositorio/dados)

2. Clique no bot√£o:  
   **"CLIQUE AQUI PARA ACESSAR OS METADADOS E DADOS PPBIO"**

3. Na p√°gina de busca, digite:  
   - T√≠tulo: **Composi√ß√£o da Comunidade de Ervas Terrestres da Reserva Ducke**  
   
O que encontrar√°:

- **Metadados**: informa√ß√µes descritivas sobre o conjunto de dados, como local de coleta, m√©todo amostral, per√≠odo do estudo, respons√°veis, unidades de medida etc.
- **Lista de esp√©cies**: todas as ervas registradas em campo organizadas por parcela
- **Matriz de composi√ß√£o**: abund√¢ncia de esp√©cies em cada unidade amostral

> üîπ O passo a passo mencionado anteriormente tem apenas car√°ter informativo. As matrizes ser√£o fornecidas nas etapas seguintes.

---

### Corre√ß√£o Taxon√¥mica

<h1 style="font-size: 32px; text-align: center;">Pr√°tica 1: Corre√ß√£o taxon√¥mica</h1>

**Corre√ß√£o taxon√¥mica baseada no projeto REFLORA**

A corre√ß√£o taxon√¥mica consiste na padroniza√ß√£o e verifica√ß√£o dos nomes cient√≠ficos das esp√©cies com base em fontes atualizadas. 

O REFLORA, em parceria com o Jardim Bot√¢nico do Rio de Janeiro, oferece acesso √† Lista de Esp√©cies da Flora do Brasil, que √© amplamente utilizada como refer√™ncia oficial para estudos bot√¢nicos e ecol√≥gicos no pa√≠s. A plataforma permite verificar sin√¥nimos, nomes v√°lidos e a classifica√ß√£o taxon√¥mica mais recente, assegurando maior precis√£o na identifica√ß√£o e an√°lise das esp√©cies.
<https://floradobrasil.jbrj.gov.br/reflora/listaBrasil/PrincipalUC/PrincipalUC.do>

![](Reflora.png)

Agora vamos aplicar essa corre√ß√£o √† **lista de esp√©cies** do banco de dados mencionado anteriormente. O arquivo cont√©m os nomes cient√≠ficos, os g√™neros e as fam√≠lias em formato `.csv`.


**Carregue a matriz de esp√©cies**

```{r}
especie = read.csv(file="species_gen_fam.csv", sep = ";")	

head(especie)	
```

**Identifica a estrutura do objeto**
```{r}
str(especie)
```

Indica se √© ou n√£o uma tabela de dados (data.frame), n√∫mero de observa√ß√µes nas linhas e vari√°veis nas colunas. 

**Torna as colunas de um data.frame acess√≠veis diretamente pelo nome**
```{r}
attach(especie) 
```

**Identificar se √© caracter** 
```{r}
class(scientificname)
as.character(scientificname)
```

Utilizaremos a fun√ß√£o `get.taxa()` do pacote `flora` para corrigir e padronizar os nomes taxon√¥micos da nossa lista de esp√©cies.

**Instalar o pacote FLORA** <https://cran.r-project.org/web/packages/flora/index.html>

`install.packages(flora)`
```{r}
library(flora)
```

**O pacote flora faz essa corre√ß√£o:**

- A fun√ß√£o `get.taxa()` busca os nomes cient√≠ficos fornecidos na **Lista de Esp√©cies da Flora do Brasil**, por meio da base oficial do projeto **REFLORA**.

- Corrige **sin√¥nimos e nomes inv√°lidos**, retornando os **nomes aceitos** segundo a classifica√ß√£o atual.

- O argumento `as.character(scientificname)` converte o vetor ou coluna `scientificname` para o formato texto, garantindo que os nomes sejam interpretados corretamente pela fun√ß√£o.

- O par√¢metro `life.form = TRUE` indica que **ser√° retornada** a informa√ß√£o sobre a forma de vida das esp√©cies (como erva, arbusto, √°rvore etc).

- Se esse argumento fosse `life.form = FALSE`, o resultado n√£o incluiria essas informa√ß√µes adicionais.

```{r}
names = get.taxa(as.character(scientificname), life.form = T)
head(names)
```

A fun√ß√£o `get.taxa()` do pacote `flora` retorna um data frame com colunas como: `id`, `scientific.name`, `accepted.name`, `family`, `taxon.rank`, `taxon.status`, `search.str`, `threat.status`, `notes`, `original.search` e `life.form`.

**Salvar a matriz de corre√ß√£o**
```{r}
write.table(names, file = "flora_gen_fam.csv", sep = ";")
```

### Filogenia

<h1 style="font-size: 32px; text-align: center;">Pr√°tica 2: Reconstru√ß√£o Filogen√©tica</h1>



---

**Organiza√ß√£o da matriz de esp√©cies (fora do R**)

Antes de importar os dados para o R, precisamos organizar a **matriz de esp√©cies** corretamente:

- O pacote `V.PhyloMaker` s√≥ reconhece nomes cient√≠ficos **com g√™nero e ep√≠teto separados por um underline** (`_`).
  
  ‚úÖ Exemplo de formato correto: `Copaifera_langsdorffii`

- Edite a lista de esp√©cies, no Excel, e garanta que todos os nomes estejam nesse formato, **sem autores, acentos ou abrevia√ß√µes**. 

- Salve o arquivo no formato `.csv`.
 


Para a reconstru√ß√£o filogen√©tica, utiliza-se a coluna `accepted.name` da lista que corrigimos anteriormente, al√©m de colunas separadas para `g√™nero` e `fam√≠lia`. √â recomend√°vel tamb√©m incluir duas colunas em branco, com os t√≠tulos `genus.GBOTB` e `spp.GBOTB`.


**Instalar o pacote V.PhyloMaker2**

O pacote `V.PhyloMaker2` n√£o est√° dispon√≠vel no CRAN, por isso precisamos instal√°-lo diretamente a partir do GitHub. Para isso, utilizamos a fun√ß√£o `install_github()` do pacote `devtools`.


`install.packages(devtools)`

`library("devtools")`

`devtools::install_github("jinyizju/V.PhyloMaker2")`

Outros pacotes tamb√©m ser√£o necess√°rios para ler e salvar a filogenia. 

`install.packages(picante)`

`install.packages(phytools)`

```{r}
library(V.PhyloMaker2)
library(picante)
library(phytools)
```

**Carregar a matriz para, em seguida, reconsrtuir a filogenia.**
```{r}
phylo  <-  read.csv("lista_phylo.csv", sep = ";")
head(phylo)
```

```{r}
tree <- phylo.maker(sp.list = phylo,  tree = GBOTB.extended.TPL,  
                      nodes = nodes.info.1.TPL, scenarios="S3")
```


**Salvar a √°rvore reconstru√≠da no formato .tre**
```{r}
write.tree(tree$scenario.3, "phylo_tree.tre")
```

**Carregar a visualizar a √°rvore**
```{r}
plot_tree <- read.tree("phylo_tree.tre")
plot_tree
```

```{r}
plot_tree$tip.label
class(plot_tree)
```

`class` retorna a classe do objeto. 

**Salvar a √°rvore reconstru√≠da no formato .jpg**
```{r}
jpeg("plot_tree.jpg", width=16, height=16, unit="cm", res=300)
```

**Visualizar a √°rvore adicionando a escala**
```{r}
plotTree(plot_tree, fsize=0.4, type="phylogram", lwd=1)
add.scale.bar(cex = 1, font = 1, col = "red")
```

A **escala** representa unidades arbitr√°rias de dist√¢ncia filogen√©tica, baseadas no n√∫mero de mudan√ßas evolutivas. 


